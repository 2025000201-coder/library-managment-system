{% extends 'base.html' %}
{% block title %}Return Book — LibraryMS{% endblock %}

{% block extra_css %}
<style>
  .return-card { border-radius: 16px; border: none; box-shadow: 0 4px 24px rgba(0,0,0,0.08); }
  .info-row { display: flex; justify-content: space-between; padding: 0.6rem 0; border-bottom: 1px solid #f0f0f0; }
  .info-row:last-child { border-bottom: none; }
  .fine-box { border-radius: 12px; padding: 1.5rem; }
  .fine-ok { background: #e8f5e9; border-left: 4px solid #2e7d32; }
  .fine-bad { background: #fce4ec; border-left: 4px solid #c62828; }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h4 class="fw-bold mb-0"><i class="bi bi-arrow-return-left me-2"></i>Return Book</h4>
  <a href="{% url 'circulation:issued_list' %}" class="btn btn-outline-secondary btn-sm">
    <i class="bi bi-arrow-left me-1"></i>Back to List
  </a>
</div>

<div class="row justify-content-center">
  <div class="col-lg-6">
    <div class="card return-card p-4">

      <!-- Book Info -->
      <h6 class="fw-bold text-muted mb-3 text-uppercase" style="font-size:0.75rem; letter-spacing:0.08em;">Book Details</h6>
      <div class="d-flex gap-3 mb-4">
        {% if issued.book.cover_image %}
        <img src="{{ issued.book.cover_image.url }}" class="rounded" style="width:70px; height:90px; object-fit:cover;">
        {% else %}
        <div class="rounded bg-primary bg-opacity-10 d-flex align-items-center justify-content-center" style="width:70px; height:90px;">
          <i class="bi bi-book text-primary fs-3"></i>
        </div>
        {% endif %}
        <div>
          <div class="fw-bold fs-5">{{ issued.book.title }}</div>
          <div class="text-muted">{{ issued.book.author }}</div>
          <div class="small text-muted">{{ issued.book.book_id }}</div>
        </div>
      </div>

      <div class="info-row"><span class="text-muted">Student</span><strong>{{ issued.student.get_full_name }}</strong></div>
      <div class="info-row"><span class="text-muted">Issue Date</span><strong>{{ issued.issue_date|date:"d M Y" }}</strong></div>
      <div class="info-row"><span class="text-muted">Due Date</span>
        <strong class="{% if overdue_days > 0 %}text-danger{% endif %}">{{ issued.due_date|date:"d M Y" }}</strong>
      </div>
      <div class="info-row"><span class="text-muted">Return Date (Today)</span><strong>{{ today|date:"d M Y" }}</strong></div>

      <!-- Fine Info -->
      <div class="mt-4 mb-4">
        {% if overdue_days > 0 %}
        <div class="fine-box fine-bad">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <div class="fw-bold text-danger"><i class="bi bi-exclamation-circle me-2"></i>Fine Applicable</div>
              <div class="small text-muted mt-1">{{ overdue_days }} days overdue × ₹{{ fine_per_day }}/day</div>
            </div>
            <div class="fs-4 fw-bold text-danger">₹{{ calculated_fine }}</div>
          </div>
        </div>
        {% else %}
        <div class="fine-box fine-ok">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <div class="fw-bold text-success"><i class="bi bi-check-circle me-2"></i>No Fine</div>
              <div class="small text-muted mt-1">Returned on time!</div>
            </div>
            <div class="fs-4 fw-bold text-success">₹0.00</div>
          </div>
        </div>
        {% endif %}
      </div>

      <!-- Confirm -->
      <form method="post">
        {% csrf_token %}
        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
          <a href="{% url 'circulation:issued_list' %}" class="btn btn-outline-secondary">Cancel</a>
          <button type="submit" class="btn btn-{% if overdue_days > 0 %}warning{% else %}success{% endif %} px-5">
            <i class="bi bi-arrow-return-left me-2"></i>Confirm Return
          </button>
        </div>
      </form>

    </div>
  </div>
</div>
{% endblock %}